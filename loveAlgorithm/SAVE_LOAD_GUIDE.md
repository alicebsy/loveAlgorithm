# 저장/로드 및 호감도 시스템 확인 가이드

## 구현된 기능

### 1. 저장/로드 시스템
- ✅ 아이디별 슬롯별 저장 (최대 10개 슬롯)
- ✅ 저장된 부분부터 불러오기
- ✅ 호감도 점수 저장 및 불러오기
- ✅ 자동 저장 (씬 이동 시, 선택지 선택 시)

### 2. 호감도 시스템
- ✅ 선택지 선택 시 호감도 점수 적용
- ✅ 호감도 백엔드 저장
- ✅ 저장 슬롯에 호감도 포함

## 확인 방법

### 1. 브라우저 개발자 도구로 확인

#### 호감도 저장 확인
1. 게임을 실행하고 선택지를 선택합니다.
2. 브라우저 개발자 도구 (F12)를 엽니다.
3. Console 탭에서 다음 메시지를 확인합니다:
   ```
   ✅ 호감도 저장 완료: 도희 = 10
   ✅ 자동 저장 완료
   ```

#### 저장 슬롯 확인
1. 게임 중 "저장/불러오기" 화면으로 이동합니다.
2. 빈 슬롯에 "저장" 버튼을 클릭합니다.
3. Console 탭에서 다음 메시지를 확인합니다:
   ```
   ✅ 게임 저장 완료: 슬롯 1
   ```

#### 불러오기 확인
1. 저장된 슬롯을 클릭합니다.
2. Console 탭에서 다음 메시지를 확인합니다:
   ```
   ✅ 게임 불러오기 완료: 슬롯 1
   ```

### 2. 네트워크 탭으로 확인

1. 브라우저 개발자 도구 (F12)를 엽니다.
2. Network 탭을 엽니다.
3. 게임을 플레이하면서 다음 API 호출을 확인합니다:

#### 호감도 저장 API
- **URL**: `POST /api/affection/{character_id}`
- **요청 본문**: `{ "affection": 10 }`
- **확인 시점**: 선택지를 선택했을 때

#### 자동 저장 API
- **URL**: `POST /api/user/progress`
- **요청 본문**: `{ "current_scene_id": "...", "affections": {...}, ... }`
- **확인 시점**: 씬 이동 시, 선택지 선택 후

#### 저장 슬롯 API
- **저장**: `POST /api/save`
- **불러오기**: `GET /api/save/{slotIndex}`
- **목록 조회**: `GET /api/save/slots`
- **삭제**: `DELETE /api/save/{slotIndex}`

### 3. 데이터베이스로 확인

#### 호감도 확인
```sql
SELECT user_id, affections 
FROM users 
WHERE user_id = {사용자_ID};
```

#### 저장 슬롯 확인
```sql
SELECT save_id, user_id, slot_index, save_title, game_state, saved_at
FROM save_slots
WHERE user_id = {사용자_ID}
ORDER BY slot_index;
```

#### 저장된 호감도 확인
```sql
SELECT slot_index, 
       JSON_EXTRACT(game_state, '$.affections') as affections
FROM save_slots
WHERE user_id = {사용자_ID};
```

### 4. 게임 내에서 확인

#### 호감도 확인
1. 게임을 플레이하면서 선택지를 선택합니다.
2. 호감도가 변경되는 선택지를 선택합니다 (예: "죽을 배달시켜 준다").
3. 저장/불러오기 화면에서 저장된 슬롯을 확인합니다.
4. 저장된 슬롯에 호감도 정보가 표시됩니다:
   ```
   호감도: 도희: 10, 지수: -1
   ```

#### 저장/불러오기 확인
1. 게임 중 특정 지점에서 저장합니다.
2. 게임을 계속 진행합니다.
3. 저장/불러오기 화면에서 저장한 슬롯을 불러옵니다.
4. 저장했던 지점으로 돌아갑니다.
5. 호감도도 저장했던 값으로 복원됩니다.

## 문제 해결

### 호감도가 저장되지 않는 경우
1. Console에서 에러 메시지 확인:
   ```
   ❌ 호감도 저장 실패: ...
   ```
2. Network 탭에서 API 호출 실패 확인
3. 백엔드 서버가 실행 중인지 확인 (`lovealgorithmgame.site:8081`)
4. 인증 토큰이 유효한지 확인 (로그인 상태 확인)

### 저장 슬롯이 보이지 않는 경우
1. `fetchSaveSlots()` 함수가 호출되었는지 확인
2. Console에서 에러 메시지 확인:
   ```
   ❌ 저장 슬롯 불러오기 실패: ...
   ```
3. 백엔드 API 응답 형식 확인 (Network 탭)

### 불러오기가 작동하지 않는 경우
1. 저장 슬롯의 `gameState` 데이터 확인
2. Console에서 에러 메시지 확인:
   ```
   ❌ 게임 불러오기 실패: ...
   ```
3. `loadFromSlot` API 응답 확인 (Network 탭)

## 테스트 시나리오

### 시나리오 1: 호감도 저장 및 불러오기
1. 게임 시작
2. Chapter 1 Scene 2에서 선택지 선택 (호감도 변경되는 선택지)
3. 저장 슬롯 1에 저장
4. 게임 종료 후 다시 시작
5. 저장 슬롯 1 불러오기
6. 호감도가 저장된 값으로 복원되었는지 확인

### 시나리오 2: 자동 저장
1. 게임 시작
2. 씬을 여러 번 이동
3. Console에서 "✅ 자동 저장 완료" 메시지 확인
4. 백엔드 DB에서 `users` 테이블의 `current_scene_id` 확인

### 시나리오 3: 여러 슬롯 저장
1. 게임 중간 지점에서 슬롯 1에 저장
2. 게임을 더 진행
3. 다른 지점에서 슬롯 2에 저장
4. 슬롯 1 불러오기 → 첫 번째 저장 지점으로 이동
5. 슬롯 2 불러오기 → 두 번째 저장 지점으로 이동
